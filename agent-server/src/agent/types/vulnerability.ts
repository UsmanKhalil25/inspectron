import { z } from "zod";

export const VulnerabilitySeverity = z.enum([
  "low",
  "medium",
  "high",
  "critical",
]);

export const VulnerabilityType = z.enum([
  "missing_header",
  "weak_header",
  "insecure_cookie",
  "exposed_secret",
  "information_disclosure",
  "mixed_content",
]);

export const VulnerabilitySchema = z.object({
  id: z.string(),
  type: VulnerabilityType,
  severity: VulnerabilitySeverity,
  title: z.string(),
  description: z.string(),
  recommendation: z.string(),
  location: z.string().optional(),
  evidence: z.string().optional(),
});

export const VulnerabilityReportSchema = z.object({
  findings: z.array(VulnerabilitySchema),
  scannedAt: z.string(),
  url: z.string(),
  riskLevel: VulnerabilitySeverity,
  summary: z.object({
    total: z.number(),
    critical: z.number(),
    high: z.number(),
    medium: z.number(),
    low: z.number(),
  }),
});

export const VulnerabilityScanStateSchema = z.object({
  url: z.string(),
  pageSource: z.string().optional(),
  responseHeaders: z.record(z.string()).optional(),
  cookies: z
    .array(
      z.object({
        name: z.string(),
        value: z.string(),
        domain: z.string(),
        path: z.string(),
        expires: z.number(),
        httpOnly: z.boolean(),
        secure: z.boolean(),
        sameSite: z.enum(["Strict", "Lax", "None"]).optional(),
      })
    )
    .optional(),
  vulnerabilities: z.array(VulnerabilitySchema).optional(),
  scanComplete: z.boolean().optional(),
});

export type Vulnerability = z.infer<typeof VulnerabilitySchema>;
export type VulnerabilityReport = z.infer<typeof VulnerabilityReportSchema>;
export type VulnerabilityScanState = z.infer<
  typeof VulnerabilityScanStateSchema
>;
export type VulnerabilitySeverityType = z.infer<typeof VulnerabilitySeverity>;
export type VulnerabilityTypeEnum = z.infer<typeof VulnerabilityType>;
